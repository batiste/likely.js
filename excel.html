<html>
<head>
<link rel="stylesheet" href="css/bootstrap.min.css">
<style>
label {

}
</style>
</head>

<body>
<div class="container">
  <div class="header">

  </div>

<div class="row">
<div class="col-md-6">

<h2>Form tests</h2>

<div id="test">table
  tbody
    tr
      th
      for key, cell in table.0
        th
          {{ key | toAlpha }}
    for key1, line in table
      tr
        th
          {{ key1 }}
        for key2, cell in line
          td
            input value={{ cell }}
            span lk-click="select(key1, key2)"
              {{ cell | expr }}
</div>

</div>
<div class="col-md-6">


<h2>Data</h2>

<pre id="data"></pre>


<h2>Template used</h2>

<pre id="template"></pre>
</div>


</div>
</div>

<script src="likely.js"></script>
<script src="lib/jsonfn.js"></script>
<script>
  var div = document.getElementById('test');
  var data_dom = document.getElementById('data');
  document.getElementById('template').innerHTML = div.innerHTML;

  function expr(v, context) {
    if(v.charAt(0) == "=") {
      v = v.substr(1);
      v = v.replace(/([a-zA-Z])([0-9])/g, function(m){return "table." + m[1] + "." + (m[0].charCodeAt(0) -65);});
      console.log(v)
      try {
        return likely.expression(v).evaluate(context);
      } catch(e) {console.log(e)}
    }
    return v;
  }

  function toAlpha(v, context) {
    return String.fromCharCode(parseInt(v, 10) + 65);
  }

  var data = {table:[
    ["","",""],
    ["","",""],
    ["","",""],
    ["","",""]
  ],
  selected: "",
  toAlpha: toAlpha,
  expr: expr,
  select: function(k1,k2) {this.selected = k1 + "." + k2; console.log(k1 + "." + k2)}
  };
  var tpl = likely.Template(div.textContent);
  data_dom.innerHTML = likely.escape(JSON.stringify(data));
  var component = new likely.Component(div, tpl, data);

  div.addEventListener("dataViewChanged", function() {
    document.getElementById('data').innerHTML = likely.escape(JSON.stringify(data));
  });

</script>