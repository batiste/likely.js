<html>
<head>
<title>Likely.js - a Python-like HTML templating language</title>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300' rel='stylesheet' type='text/css'>
<style>

body {
  padding:20px 20px 80px 20px;
  font-family:sans-serif;
}

h1, h2, h3 {  
  font-family: 'Roboto', sans-serif;
  font-weight:400;
}

button {
  padding:10px;
}

#resulth * {
  -moz-animation-duration: 3s;
  -webkit-animation-duration: 3s;
  -moz-animation-name: slidein;
  -webkit-animation-name: slidein;
}

@-moz-keyframes slidein {
  from {
    background:#ee0;
  }

  to {
    background:#fff;
  }
}

@-webkit-keyframes slidein {
  from {
    background:#ee0;
  }

  to {
    background:#fff;
  }
}

</style>
</head>
<body>
<h1>Likely.js is a Python-like HTML templating language</h1>

<p>Likely.js offers a python inspired language for HTML generation
as well as an automatic bidirectional data binding between the DOM and the data Model.</p>

<p>When a template is rendered, Likely.js is will annotate the HTML elements with the source path of the data (only the elements with a value attribute). 
<br>
If you modify the value of one of those elements Likely.js can automatically reflect the changes back to the data object.</p>

<p>In addition Likely.js is also able to do update the DOM selectively when the data are modified. 
To achieve this goal Likely.js saves a hash of every partial in the DOM element and can therefore
knows when the partial HTML need to be updated.</p>

<p><a href="https://github.com/batiste/likely.js">Fork on github</a></p>

<h2>Templating</h2>

<p>
If you want to be able render only the DOM elements that have changed you will need
<strong>an unique ID</strong> and the <strong>data-partial</strong> attribute on the element.
</p>

<textarea id="template" style="width:850px;height:400px;" spellcheck="false">ul
 for number in list
  # a blank line is left bellow so the HTML output is more readable
  
  li id="id-{{ forIndex }}" data-partial="true" style="color:{{ number > limit and "green" or "red" }}"
     if number.hello
      "Number is an object "
      for value in number
       "{{ index }} : "
       input value="{{ value }}"
     elseif number &lt; limit
       "Number {{ number }} is smaller than the limit. "
       input value="{{ number }}"
     elseif number==limit
       "Number is equal to the limit."
       input value="{{ number }}"
     else
       "Number {{ number }} is bigger than than the limit. "
       input value="{{ number }}"

label id="p2" data-partial="true" class="changed"
 "Limit: "
 input value={{ limit }}

</textarea>

<h2>Data</h2>

<p>The data required to render an template can be any JavaScript object. There is not need
for any special interface.</p>


<textarea id="data" style="width:850px;height:100px;" spellcheck="false">
{"list": [0,{"hello":"world", "prop1": 22, "prop2": 24},2,3,5,6,7,8,9], "limit":5}
</textarea><br>
<button id="updateData">Update result</button>
<button id="updateDataPartial">Update result partially</button>

<h2>Rendered result</h2>
<div id="resulth">
</div>

<h2>Html output</h2>
<pre id="result">
</pre>


<h2>Speed test</h2>

<button id="compile">Compile the template 1000 times <span id="compileres"></span></button>
<button id="render">Render the template 1000 times <span  id="renderres"></span></button>


<h2>API</h2>

<h3>likely.Context(data:Object)</h3>

<p>Build a Context object. It's is used to be passed to the likely.Template object's methods.</p>

<h3>likely.Template(template:String)</h3>

<p>Build a template object, the template object has 2 methods:</p>

<ol>
  <li>likely.Template.render(context:likely.Context) : return a string of the rendered template.</li>
  <li>likely.Template.renderTo(context:likely.Context, dom:DOM Element, [partialRender:Boolean]) : return a string of the rendered 
  template. Update the DOM element  partially if partialRender is true.</li>
</ol>

<h3>likely.PartialRenderFailed</h3>

<p>A partial render can fail for various reasons. If that happen this error will be raised with more precise 
error message.</p>

<h3>likely.CompileError</h3>

<p>This error is raised when the compilation of a template has failed. There is more informations
in the error message.</p>

<h3>likely.updateData(data:Object, input:DOM element)</h3>
 
<p>When an input DOM Element changes value, you can call this function to reflect the change on the data source.
It's you job to know which data object has to be passed here.</p>

<h2>Typical use of likely.js</h2>

<pre>
var data = {"hello": "world"};
var domElement = document.getElementById("content");
var template = likely.Template("...");
var context = likely.Context(data);

domElement.addEventListener("keyup", function(event) {
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    likely.updateData(data, target);
  }
});

// first a normal render is necessary
template.renderTo(context, domElement);

data.hello = "New world";

// then a partial render
try {
  render = t.renderTo(context, domElement, true);
} catch (e) {
  if (e instanceof likely.PartialRenderFailed) {
    // if we have a PartialRenderFailed error, we must do a normal render
    render = t.renderTo(context, domElement);
  } else {
    throw e; // let others errors show up
  }
}

</pre>




<script src="likely.js"></script>

<script>

function get(id) { return document.getElementById(id); }

var r = get("result");
var rh = get("resulth");
var tpl = get("template");
var d = get("data");
var t, render;
function show(partial) {
  try {
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    if(partial) {
      try {
        render = t.renderTo(context, rh, true);
      } catch (e) {
        if (e instanceof likely.PartialRenderFailed) {
          render = t.renderTo(context, rh, false);
          r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        } else {
          throw e; // let others bubble up
        }
      }
    } else {
      render = t.renderTo(context, rh, false);
      r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }

  } catch(err) {
    render = String(err);
    r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    rh.innerHTML = render;
    throw err;
  }

}

tpl.onkeyup = function(){ show(false); };
show(false);
get("updateData").onclick = function(){ show(false); };
get("updateDataPartial").onclick = function(){ show(true); };


rh.addEventListener("keyup", function(event) {
  event = event || window.event
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    var data = JSON.parse(d.value);
    likely.updateData(data, target);
    d.value = JSON.stringify(data);
  }
});

document.addEventListener("change", function(event) {
  event = event || window.event
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    try {
      // render partially
      render = t.renderTo(context, rh, true);
    } catch (e) {
      if (e instanceof likely.PartialRenderFailed) {
        r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        rh.innerHTML = render;
      } else {
        throw e; // let others bubble up
      }
    }



  }
});

function Timer(){
  var start;
  return {
    start: function(){
      start = new Date; 
      return this;
    },
    stop:  function(mssg) {
      return (new Date - start);
    },
  };
}

var compile = get("compile");
var compileres = get("compileres");
var render = get("render");
var renderres = get("renderres");

compile.onclick = function() {
  
    var tplStr = tpl.value;
    var timer = new Timer().start();
    for(i=0; i<1000; i++) {
      t = likely.Template(tplStr);
    }
    compileres.innerHTML = ": done in " + timer.stop() + "ms";
}

render.onclick = function() {
  
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    var timer = new Timer().start();
    for(i=0; i<1000; i++) {
      render = t.render(context);
    }
    renderres.innerHTML = ": done in " + timer.stop() + "ms";
}


</script>
