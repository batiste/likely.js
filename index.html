<html>
<body>
<h1>Likely.js is a Python like HTML templating language with data Model features</h1>

<p>This template language offers a python style indentation for HTML generation
as well an automatic bi-directionnal data binding between the DOM and the data Model.</p>

<p>Imagine generating HTML with a template language and getting you data automticaly updated
as the use change them in form. This is what likely.js is doing to do for you.</p>

<p><a href="https://github.com/batiste/likely.js">On github</a></p>

<h2>Template</h2>
<textarea id="template" style="width:500px;height:340px;" spellcheck="false">ul
 for number in list
  
  li id="id-{{ number.hello or number }}"
   if number.hello
    "Number is an object with an hello attribute of value "
    input value="{{ number.hello }}"
   elseif number < limit
    label style="color:red"
     "Number {{ number }} is smaller than {{ limit }}. "
     input value="{{ number }}"
   elseif number==limit
    label
     "Number is {{ limit }}."
     input value="{{ number }}"
   else
    label style="color:green"
     "Number {{ number }} is bigger than {{ limit }}. "
     input value="{{ number }}"
 
input value={{ limit }}

</textarea>

<h2>Data</h2>

<textarea id="data" style="width:500px;height:100px;" spellcheck="false">
{
  "list": [0,{"hello":"world"},2,3,5,6,7,8,9], 
  "limit":5
}
</textarea>

<h2>Rendered result</h2>
<div id="resulth">
</div>

<h2>Html output</h2>
<pre id="result">
</pre>


<h2>Speed test</h2>

<button id="compile">Compile the template 1000 times <span id="compileres"></span></button>
<button id="render">Render the template 1000 times <span  id="renderres"></span></button>

<script src="likely.js"></script>

<script>

var r = document.getElementById("result");
var rh = document.getElementById("resulth");
var tpl = document.getElementById("template");
var d = document.getElementById("data");
var t, render;
function show() {
  try {
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);
    render = t.render(context);
  } catch(err) {
    render = String(err);
  }
  r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
  rh.innerHTML = render;
}

tpl.onkeyup = show;
show();
d.onkeyup = show;


document.addEventListener("keyup", function(event) {
  event = event || window.event
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    var data = JSON.parse(d.value);
    likely.updateData(data, target);
    d.value = JSON.stringify(data);
  }
});

document.addEventListener("change", function(event) {
  event = event || window.event
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    show();
  }
});

function Timer(){
  var start;
  return {
    start: function(){
      start = new Date; 
      return this;
    },
    stop:  function(mssg) {
      return (new Date - start);
    },
  };
}

var compile = document.getElementById("compile");
var compileres = document.getElementById("compileres");
var render = document.getElementById("render");
var renderres = document.getElementById("renderres");

compile.onclick = function() {
  
    var tplStr = tpl.value;
    var timer = new Timer().start();
    for(i=0; i<1000; i++) {
      t = likely.Template(tplStr);
    }
    compileres.innerHTML = ": done in " + timer.stop() + "ms";
}

render.onclick = function() {
  
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    var timer = new Timer().start();
    for(i=0; i<1000; i++) {
      render = t.render(context);
    }
    renderres.innerHTML = ": done in " + timer.stop() + "ms";
}


</script>
