<html>
<head>
<title></title>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300' rel='stylesheet' type='text/css'>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<style>

body {
  padding:20px 20px 80px 20px;
  font-family:sans-serif;
  font-size:16px;
}

h1, h2, h3 {  
  font-family: 'Roboto', sans-serif;
  font-weight:400;
}

button {
  padding:10px;
}

textarea {
  font-size:16px;
}

#resulth * {
  -moz-animation-duration: 3s;
  -webkit-animation-duration: 3s;
  -moz-animation-name: slidein;
  -webkit-animation-name: slidein;
}

@-moz-keyframes slidein {
  from {
    background:#47a447;
  }

  to {
    background:#fff;
  }
}

@-webkit-keyframes slidein {
  from {
    background:#47a447;
  }

  to {
    background:#fff;
  }
}

</style>
</head>
<body>

<div class="container">
  <div class="header">

  <div class="jumbotron">
    <h1>Likely.js template library</h1>
    <p class="lead">Likely.js offers a python inspired templating language for HTML generation. Likely.js offers 
      efficient HTML diff, and bidirectional data binding.</p>
    <p><a class="btn btn-lg btn-success" href="https://github.com/batiste/likely.js" role="button">On github</a></p>
  </div>

<h2>Feature list</h2>

<ol>
  <li>Smart html diff (no innerHTML required).</li>
  <li>Bidirectional data binding.</li>
  <li>A simple but powerfull template and expression engine similar to Liquid/Django/Mustache template.</li>
</ol>

<h2>Template</h2>

<p>A change in the template redraw the content completly</p>

<textarea id="template" style="width:850px;height:100px;" spellcheck="false">for key, item in list
  p
    "{{ key }} :"
    input type="text" value={{ item }}</textarea>

<h2>Data</h2>

<p>A change in the data change only what is necessary</p>

<textarea id="data" style="width:850px;height:60px;" spellcheck="false">
{"list":{"Email":"test@example.com", "Firstname":"Charles", "Lastname":"Darwin"}}
</textarea><br>


<h2>Rendered result</h2>
<div id="resulth">
</div>

<h2>Html output</h2>
<pre id="result">
</pre>

<h2>More</h2>

<a href="testsuite.html" class="btn btn-success">Test suite</a>
<a class="btn btn-success" href="https://github.com/batiste/likely.js">On github</a>


</div>
</div>

<script src="likely.js"></script>

<script>

function get(id) { return document.getElementById(id); }

var r = get("result");
var rh = get("resulth");
var tpl = get("template");
var d = get("data");
var t, render;

var currentTemplate = likely.Template(tpl.value);
var currentTree = tree(d.value);

function rebuild() {
  currentTemplate = likely.Template(tpl.value);
  currentTree = tree();
  rh.innerHTML = "";
  currentTree.dom_tree(rh);
  r.innerHTML = likely.escape(rh.innerHTML);
}

function tree() {
  var data = JSON.parse(d.value);
  var context = new likely.Context(data);
  return currentTemplate.tree(context);
}

function diff() {
  try{
    newTree = tree();
  } catch(err) {
    return;
  }
  var diff = currentTree.diff(newTree);
  likely.apply_diff(diff, rh);
  currentTree = newTree;
  r.innerHTML = likely.escape(rh.innerHTML);
}

rh.addEventListener("keyup", function(e) {

  var item = e.target;
  var binding = item.getAttribute('data-binding');
  if(binding) {
    var data = JSON.parse(d.value);
    likely.updateData(data, item);
    d.value = JSON.stringify(data);
  }

});


tpl.onkeyup = function(){ rebuild(); };
d.onkeyup = function(){ diff(); };
rebuild();

function Timer(){
  var start;
  return {
    start: function(){
      start = new Date;
      return this;
    },
    stop:  function(mssg) {
      return (new Date - start);
    },
  };
}



</script>
