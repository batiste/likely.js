<html>
<head>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300' rel='stylesheet' type='text/css'>
<style>

body {
  padding:20px 20px 80px 20px;
  font-family:sans-serif;
}

h1, h2 {  
  font-family: 'Roboto', sans-serif;
  font-weight:300;
}

button {
  padding:10px;
}

.changed {
  -moz-animation-duration: 3s;
  -webkit-animation-duration: 3s;
  -moz-animation-name: slidein;
  -webkit-animation-name: slidein;
}

@-moz-keyframes slidein {
  from {
    background:#ee0;
  }

  to {
    background:#fff;
  }
}

@-webkit-keyframes slidein {
  from {
    background:#ee0;
  }

  to {
    background:#fff;
  }
}

</style>
</head>
<body>
<h1>Likely.js is a Python-like HTML templating language</h1>

<p>Likely.js offers a python inspired language for HTML generation
as well as an automatic bi-directionnal data binding between the DOM and the data Model.</p>

<p>When a template is rendered, Likely.js is will annotate the HTML elements with the source path of the data. 
<br>
Then if you modify the content
of a form Likely.js can automatically reflect the changes on the data.
<br>
In addition Likely.js is also able to do partial update of the DOM when the data are modified. 
But only under certain conditions.</p>

<p><a href="https://github.com/batiste/likely.js">Fork on github</a></p>

<h2>Templating</h2>

<p>If you want to render only the DOM elements that have changed you will need
<strong>an unique ID</strong> and the <strong>data-partial</strong> attribute on the element.
Likely.js is not able to add or delete DOM elements. If a new element is detected, Likely.js will throw an exception.
In this case the whole template will need to be completly rendered.
</p>

<textarea id="template" style="width:800px;height:400px;" spellcheck="false">ul
 li class="changed" 
  "This list item should not get updated"
 for number in list
  
  li id="id-{{ loop }}" data-partial="true" class="changed" 
   label style="color:{{ number > limit and "green" or "red" }}"
     if number.hello
      "Number is an object with an hello attribute of value "
      input value="{{ number.hello }}"
     elseif number < limit
       "Number {{ number }} is smaller than {{ limit }}. "
       input value="{{ number }}"
     elseif number==limit
       "Number is {{ limit }}."
       input value="{{ number }}"
     else
       "Number {{ number }} is bigger than {{ limit }}. "
       input value="{{ number }}"

label
 "Limit: "
 input value={{ limit }}

</textarea>

<h2>Data</h2>

<p>The data required to render an template can be any JavaScript object. There is not need
for any special interface.</p>


<textarea id="data" style="width:800px;height:100px;" spellcheck="false">
{
  "list": [0,{"hello":"world"},2,3,5,6,7,8,9], 
  "limit":5
}
</textarea>

<h2>Rendered result</h2>
<div id="resulth">
</div>

<h2>Html output</h2>
<pre id="result">
</pre>


<h2>Speed test</h2>

<button id="compile">Compile the template 1000 times <span id="compileres"></span></button>
<button id="render">Render the template 1000 times <span  id="renderres"></span></button>

<script src="likely.js"></script>

<script>

var r = document.getElementById("result");
var rh = document.getElementById("resulth");
var tpl = document.getElementById("template");
var d = document.getElementById("data");
var t, render;
function show() {
  try {
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    try {
      render = t.render(context, true);
    } catch (e) {
      if (e instanceof likely.PartialRenderFailed) {
        render = t.render(context);
        r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        rh.innerHTML = render;
      } else {
        throw e; // let others bubble up
      }
    }

  } catch(err) {
    render = String(err);
    r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    rh.innerHTML = render;
  }


}

tpl.onkeyup = show;
show();
d.onkeyup = show;


document.addEventListener("keyup", function(event) {
  event = event || window.event
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    var data = JSON.parse(d.value);
    likely.updateData(data, target);
    d.value = JSON.stringify(data);
  }
});

document.addEventListener("change", function(event) {
  event = event || window.event
  var target = event.target || event.srcElement;
  if(target.getAttribute("data-path")) {
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    try {
      render = t.render(context, true);
    } catch (e) {
      if (e instanceof likely.PartialRenderFailed) {
        r.innerHTML = render.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        rh.innerHTML = render;
      } else {
        throw e; // let others bubble up
      }
    }



  }
});

function Timer(){
  var start;
  return {
    start: function(){
      start = new Date; 
      return this;
    },
    stop:  function(mssg) {
      return (new Date - start);
    },
  };
}

var compile = document.getElementById("compile");
var compileres = document.getElementById("compileres");
var render = document.getElementById("render");
var renderres = document.getElementById("renderres");

compile.onclick = function() {
  
    var tplStr = tpl.value;
    var timer = new Timer().start();
    for(i=0; i<1000; i++) {
      t = likely.Template(tplStr);
    }
    compileres.innerHTML = ": done in " + timer.stop() + "ms";
}

render.onclick = function() {
  
    var data = JSON.parse(d.value);
    t = likely.Template(tpl.value);
    var context = likely.Context(data);

    var timer = new Timer().start();
    for(i=0; i<1000; i++) {
      render = t.render(context);
    }
    renderres.innerHTML = ": done in " + timer.stop() + "ms";
}


</script>
